From 6928e8933e8b6c98c0590985866cc12e7321f491 Mon Sep 17 00:00:00 2001
From: Albert Astals Cid <aacid@kde.org>
Date: Sat, 26 Dec 2020 12:21:22 +0100
Subject: Free the previous user_image in case spectre_presize is called
 multiple times

---
 libspectre/spectre-device.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/libspectre/spectre-device.c b/libspectre/spectre-device.c
index 4a09518..708fcb0 100644
--- a/libspectre/spectre-device.c
+++ b/libspectre/spectre-device.c
@@ -72,6 +72,7 @@ spectre_presize (void *handle, void *device, int width, int height,
 	sd->height = height;
 	sd->row_length = raster;
 	sd->gs_image = NULL;
+	free(sd->user_image);
 	sd->user_image = malloc (sd->row_length * sd->height);
 	
 	return 0;
-- 
cgit v1.2.1

