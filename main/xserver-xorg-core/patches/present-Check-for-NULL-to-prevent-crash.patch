From 69774044716039fa70655b3bc6dd6a4ff4535cfd Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?B=C5=82a=C5=BCej=20Szczygie=C5=82?= <spaz16@wp.pl>
Date: Thu, 13 Jan 2022 00:47:27 +0100
Subject: [PATCH] present: Check for NULL to prevent crash
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Closes: https://gitlab.freedesktop.org/xorg/xserver/-/issues/1275
Signed-off-by: Błażej Szczygieł <spaz16@wp.pl>
Tested-by: Aaron Plattner <aplattner@nvidia.com>
(cherry picked from commit 22d5818851967408bb7c903cb345b7ca8766094c)
---
 present/present_scmd.c | 6 ++++++
 1 file changed, 6 insertions(+)

--- a/present/present_scmd.c
+++ b/present/present_scmd.c
@@ -161,6 +161,9 @@
     if (!screen_priv->info->get_crtc)
         return NULL;
 
+    if (!screen_priv->info->get_crtc)
+        return NULL;
+
     return (*screen_priv->info->get_crtc)(window);
 }
 
@@ -200,6 +203,9 @@
         return;
 
     if (!screen_priv->info->flush)
+        return;
+
+    if (!screen_priv->info->flush)
         return;
 
     (*screen_priv->info->flush) (window);
